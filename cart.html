<!DOCTYPE html>
<html lang="en" ng-app=""CartApp>

<head>
   <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
   <meta charset="UTF-8">
   <title>Shopping Cart</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <style>
      .cart-container {
         max-width: 600px;
         margin: 50px auto;
         background: #fff;
         padding: 20px;
         border-radius: 8px;
         box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
      }

      .cart-item {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 10px 0;
         border-bottom: 1px solid #ddd;
      }

      .cart-item img {
         width: 50px;
         height: auto;
         margin-right: 10px;
      }
   </style>
</head>

<body ng-controller="CartController">
   <div class="cart-container">
      <h2>Your Shopping Cart</h2>
      <div id="cartItems">
         <p ng-if="cart.length === 0">Your cart is empty.</p>
         <div class="cart-item" ng-repeat="item in cart track by $index">
            <img ng-src="{{item.img}}" alt="{{item.name}}">
            <span>{{item.name}} - ${{item.price.toFixed(2)}}</span>
            <input type="number" min="1" ng-model="item.quantity" ng-change="updateQuantity($index, item.quantity)">
            <button class="btn btn-sm btn-danger" ng-click="removeFromCart($index)">Remove</button>
         </div>
      </div>
      <p class="cart-total mt-3"><strong>Total: ${{calculateTotal().toFixed(2)}}</strong></p>

      <button class="btn btn-danger w-100 mb-2" ng-click="clearCart()">Clear Cart</button>
      <a href="Shipping.html" class="btn btn-primary w-100 mb-2"> Submit Order</a>
      <a href="index.html" class="btn btn-secondary w-100">Back to Shop</a>
   </div>


   <script>
      angular.module('CartApp', [])
        .controller('CartController', ['$scope', '$http', function($scope, $http) {
            $scope.cart = [];
            
            // Load cart from backend
            $scope.loadCart = function() {
                $http.get('/api/cart')
                    .then(function(response) {
                        $scope.cart = response.data;
                    })
                    .catch(function(error) {
                        console.error('Error loading cart:', error);
                    });
            };
            
            // Calculate total
            $scope.calculateTotal = function() {
                return $scope.cart.reduce((total, item) => {
                    return total + (item.price * (item.quantity || 1));
                }, 0);
            };
            
            // Update quantity
            $scope.updateQuantity = function(index, quantity) {
                if (quantity < 1) quantity = 1;
                $http.put('/api/cart/' + $scope.cart[index].id, { quantity: quantity })
                    .then(function() {
                        $scope.loadCart();
                    });
            };
            
            // Remove from cart
            $scope.removeFromCart = function(index) {
                $http.delete('/api/cart/' + $scope.cart[index].id)
                    .then(function() {
                        $scope.loadCart();
                    });
            };
            
            // Clear cart
            $scope.clearCart = function() {
                $http.delete('/api/cart')
                    .then(function() {
                        $scope.cart = [];
                    });
            };
            
            // Initialize
            $scope.loadCart();
        }]);
   </script>
</body>

</html>
