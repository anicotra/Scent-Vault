<!DOCTYPE html>
<html lang="en" ng-app="ShippingApp">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Checkout and Shipping</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="style.css">
</head>

<body ng-controller="ShippingController">
   <div class="container">
      <!--progress bar-->
      <div class="progress-steps mt-4">
         <div class="step completed">
            <div class="step-number">1</div>
            <div class="step-label">Cart</div>
         </div>
         <div class="step active">
            <div class="step-number">2</div>
            <div class="step-label">Shipping</div>
         </div>
         <div class="step">
            <div class="step-number">3</div>
            <div class="step-label">Payment</div>
         </div>
         <div class="step">
            <div class="step-number">4</div>
            <div class="step-label">Confirmation</div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-8">
            <div class="Shipping-container">
               <div class="Shipping-header">
                  <h2> Shipping Information </h2>
                  <p class="text-muted"> Please provide your shipping details</p>
               </div>

               <!--shipping address form-->
               <div class="form-section">
                  <h3>Shipping Address</h3>
                  <form id="shippingForm">
                     <div class="row mb-3">
                        <div class="col-md-6">
                           <label for="firstName" class="form-label">First Name</label>
                           <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-6">
                           <label for="lastName" class="form-label">Last Name</label>
                           <input type="text" class="form-control" id="lastName" required>
                        </div>
                     </div>
                     <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="address" required>
                     </div>
                     <div class="row mb-3">
                        <div class="col-md-6">
                           <label for="city" class="form-label">City</label>
                           <input type="text" class="form-control" id="city" required>
                        </div>
                        <div class="col-md-3">
                           <label for="state" class="form-label">State</label>
                           <select class="form-select" id="state" required>
                                 <option value="">Select</option>
                                 <option value="">Select</option>
                                 <option value="AL">Alabama</option>
                                 <option value="AK">Alaska</option>
                                 <option value="AZ">Arizona</option>
                                 <option value="AR">Arkansas</option>
                                 <option value="CA">California</option>
                                 <option value="CO">Colorado</option>
                                 <option value="CT">Connecticut</option>
                                 <option value="DE">Delaware</option>
                                 <option value="FL">Florida</option>
                                 <option value="GA">Georgia</option>
                                 <option value="HI">Hawaii</option>
                                 <option value="ID">Idaho</option>
                                 <option value="IL">Illinois</option>
                                 <option value="IN">Indiana</option>
                                 <option value="IA">Iowa</option>
                                 <option value="KS">Kansas</option>
                                 <option value="KY">Kentucky</option>
                                 <option value="LA">Louisiana</option>
                                 <option value="ME">Maine</option>
                                 <option value="MD">Maryland</option>
                                 <option value="MA">Massachusetts</option>
                                 <option value="MI">Michigan</option>
                                 <option value="MN">Minnesota</option>
                                 <option value="MS">Mississippi</option>
                                 <option value="MO">Missouri</option>
                                 <option value="MT">Montana</option>
                                 <option value="NE">Nebraska</option>
                                 <option value="NV">Nevada</option>
                                 <option value="NH">New Hampshire</option>
                                 <option value="NJ">New Jersey</option>
                                 <option value="NM">New Mexico</option>
                                 <option value="NY">New York</option>
                                 <option value="NC">North Carolina</option>
                                 <option value="ND">North Dakota</option>
                                 <option value="OH">Ohio</option>
                                 <option value="OK">Oklahoma</option>
                                 <option value="OR">Oregon</option>
                                 <option value="PA">Pennsylvania</option>
                                 <option value="RI">Rhode Island</option>
                                 <option value="SC">South Carolina</option>
                                 <option value="SD">South Dakota</option>
                                 <option value="TN">Tennessee</option>
                                 <option value="TX">Texas</option>
                                 <option value="UT">Utah</option>
                                 <option value="VT">Vermont</option>
                                 <option value="VA">Virginia</option>
                                 <option value="WA">Washington</option>
                                 <option value="WV">West Virginia</option>
                                 <option value="WI">Wisconsin</option>
                                 <option value="WY">Wyoming</option>
                               </select>
                        </div>
                        <div class="col-md-3">
                           <label for="zipCode" class="form-label">ZIP Code</label>
                           <input type="text" class="form-control" id="zipCode" required>
                        </div>
                     </div>
                     <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" required>
                        <small class="text-muted">For order confirmation and returns</small>
                     </div>
                     <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="saveAddress">
                        <label class="form-check-label" for="saveAddress">
                         Save this address for future orders
                       </label>
                     </div>
                  </form>
               </div>

               

               <!--shipping -->
               <div class="form-section">
                  <h3>Shipping Method</h3>
                  <div class="mb-3">
                     <div class="shipping-option mb-2 p-3" onclick="selectShippingMethod('standard')">
                        <div class="fw-bold">Standard Shipping</div>
                        <span class="text-muted">3-5 business days - $5.99</span>
                     </div>

                     <div class="shipping-option mb-2 p-3" onclick="selectShippingMethod('express')">
                        <div class="fw-bold">Express Shipping</div>
                        <span class="text-muted">2-3 business days - $12.99</span>
                     </div>

                     <div class="shipping-option p-3" onclick="selectShippingMethod('overnight')">
                        <div class="fw-bold">Overnight Shipping</div>
                        <span class="text-muted">Next business day - $24.99</span>
                     </div>
                  </div>
               </div>

               <!-- Shipping Carrier Section -->
               <div class="form-section">
                  <h3>Shipping Carrier</h3>
                  <div class="row g-3">
                     <div class="col-md-4">
                        <div class="shipping-option text-center p-3" onclick="selectShippingCarrier('usps')">
                           <img src="https://uspsblog.com/wp-content/uploads/2015/11/USPS_Eagle-Symbol-web-size.png"
                     alt="USPS" style="height: 40px; margin-bottom: 10px;">
                           <div class="fw-bold">USPS</div>
                        </div>
                     </div>

                     <div class="col-md-4">
                        <div class="shipping-option text-center p-3" onclick="selectShippingCarrier('ups')">
                           <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/United_Parcel_Service_logo_2014.svg/1200px-United_Parcel_Service_logo_2014.svg.png"
                     alt="UPS" style="height: 40px; margin-bottom: 10px;">
                           <div class="fw-bold">UPS</div>
                        </div>
                     </div>

                     <div class="col-md-4">
                        <div class="shipping-option text-center p-3" onclick="selectShippingCarrier('fedex')">
                           <img src="https://cdn.sanity.io/images/kts928pd/production/c423a9d143ae2a03c1e7076e9abf851a19fceaec-1600x900.png"
                     alt="FedEx" style="height: 40px; margin-bottom: 10px;">
                           <div class="fw-bold">FedEx</div>
                        </div>
                     </div>
                  </div>
               </div>


               <div class="d-flex justify-content-between mt-4">
                  <a href="cart.html" class="btn btn-outline-secondary">Back to Cart</a>
                  <button type="button" class="btn btn-primary" onclick="proceedToPayment()">Continue to Payment</button>
               </div>
            </div>
         </div>

         <!--order summary-->
         <div class="col-lg-4">
            <div class="cart-summary">
               <h4>Order Summary</h4>
               <div id="orderItems">
                  <div class="cart-item" ng-repeat="item in cart">
                     <span>{{item.name}} × {{item.quantity || 1}}</span>
                     <span>${{(item.price * (item.quantity || 1)).toFixed(2)}}</span>
                  </div>
               </div>
               <hr>
               <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal:</span>
                  <span>${{calculateSubtotal().toFixed(2)}}</span>
               </div>
               <div class="d-flex justify-content-between mb-2">
                  <span>Tax (6%):</span>
                  <span>${{calculateTax().toFixed(2)}}</span>
               </div>
               <div class="d-flex justify-content-between mb-2">
                  <span>Shipping:</span>
                  <span>${{shippingCost.toFixed(2)}}</span>
               </div>
               <hr>
               <div class="d-flex justify-content-between fw-bold">
                  <span>Total:</span>
                  <span>${{calculateTotal().toFixed(2)}}</span>
               </div>
            </div>
         </div>
      </div>
   </div>

   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
      angular.module('ShippingApp', [])
        .controller('ShippingController', ['$scope', '$http', function($scope, $http) {
            $scope.cart = [];
            $scope.shippingMethod = null;
            $scope.shippingCost = 0;
            
            // Load cart
            $scope.loadCart = function() {
                $http.get('/api/cart')
                    .then(function(response) {
                        $scope.cart = response.data;
                    });
            };
            
            // Calculate subtotal
            $scope.calculateSubtotal = function() {
                return $scope.cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            };
            
            // Calculate tax
            $scope.calculateTax = function() {
                return $scope.calculateSubtotal() * 0.06;
            };
            
            // Calculate total
            $scope.calculateTotal = function() {
                return $scope.calculateSubtotal() + $scope.calculateTax() + $scope.shippingCost;
            };
            
            // Select shipping method
            $scope.selectShippingMethod = function(method) {
                $scope.shippingMethod = method;
                if (method === 'standard') $scope.shippingCost = 5.99;
                if (method === 'express') $scope.shippingCost = 12.99;
                if (method === 'overnight') $scope.shippingCost = 24.99;
            };
            
            // Proceed to payment
            $scope.proceedToPayment = function() {
                const shippingData = {
                    address: {
                        firstName: document.getElementById('firstName').value,
                        lastName: document.getElementById('lastName').value,
                        address: document.getElementById('address').value,
                        city: document.getElementById('city').value,
                        state: document.getElementById('state').value,
                        zipCode: document.getElementById('zipCode').value,
                        email: document.getElementById('email').value
                    },
                    method: $scope.shippingMethod,
                    cost: $scope.shippingCost
                };
                
                $http.post('/api/shipping', shippingData)
                    .then(function() {
                        window.location.href = 'payment.html';
                    });
            };
            
            // Initialize
            $scope.loadCart();
        }]);
   </script>
</body>

</html>
