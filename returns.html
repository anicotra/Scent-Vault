<!DOCTYPE html>
<html lang="en" ng-app="returnsApp">
<head>
  <meta charset="UTF-8">
  <title>Returns Center | Scent Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
   <link rel="stylesheet" href="style.css">
   <script src="script.js"></script>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

  <style>
    body { padding: 20px; }

    /* hide all steps except the active one */
    .step-section { display: none; }
    .step-section.active { display: block; }

    .order-card {
      padding: 15px; margin-bottom: 10px;
      border: 1px solid #ddd; border-radius: 5px;
      cursor: pointer;
    }
    .order-card.selected {
      border-color: #0d6efd;
      background-color: #f8f9fa;
    }

    .reason-option {
      display: inline-block;
      padding: 10px 15px; margin: 5px;
      border: 1px solid #ddd; border-radius: 5px;
      cursor: pointer;
    }
    .reason-option.selected {
      border-color: #0d6efd;
      background-color: #f8f9fa;
    }

    .product-img {
      width: 60px; height: 60px;
      object-fit: cover; border-radius: 4px;
      margin-right: 10px;
    }
  </style>
</head>

<body ng-controller="ReturnsController" class="p-4">
  <div class="container">
    <h2>Returns Center</h2>

    <!-- STEP 1 -->
    <div class="step-section" ng-class="{active: currentStep===1}">
      <h4>1. Find Your Order</h4>
      <p class="text-muted">Enter either your email address or your confirmation number.</p>
      <div class="row g-2 mb-3">
        <div class="col-md-6">
          <input ng-model="search.email" type="email" class="form-control" placeholder="Email Address">
        </div>
        <div class="col-md-6">
          <input ng-model="search.orderNumber" type="text" class="form-control" placeholder="Confirmation Number">
        </div>
      </div>
      <button class="btn btn-primary me-2" ng-click="findOrders()">Find Orders</button>
      <a href="index.html" class="btn btn-secondary">Back to Home</a>
    </div>

    <!-- STEP 2 -->
    <div class="step-section" ng-class="{active: currentStep===2}">
      <h4>2. Select Your Order</h4>
      <div ng-if="orders.length===0">
        <p class="text-muted">No matching orders found.</p>
        <button class="btn btn-secondary" ng-click="goToStep(1)">Back</button>
      </div>
      <div ng-if="orders.length>0">
        <div class="order-card"
             ng-repeat="o in orders"
             ng-click="selectOrder(o)"
             ng-class="{'selected': selectedOrder===o}">
          <h5>Order #{{o.confirmationNumber}}</h5>
          <p>
            Date: {{o.date | date:'mediumDate'}} &bull;
            Total: ${{ getOrderTotal(o).toFixed(2) }}
          </p>
        </div>
        <button class="btn btn-secondary me-2" ng-click="goToStep(1)">Back</button>
        <button class="btn btn-primary" ng-disabled="!selectedOrder" ng-click="goToStep(3)">Continue</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="step-section" ng-class="{active: currentStep===3}">
      <h4>3. Select Items to Return</h4>
      <div class="table-responsive mb-3">
        <table class="table">
          <thead>
            <tr>
              <th></th>
              <th>Image</th>
              <th>Product</th>
              <th>Price</th>
              <th>Qty</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="item in selectedOrder.items">
              <td><input type="checkbox" ng-model="item.selected"></td>
              <td><img ng-src="{{item.image}}" class="product-img"></td>
              <td>{{item.name}}</td>
              <td>${{item.price.toFixed(2)}}</td>
              <td>
                <select class="form-select"
                        ng-model="item.returnQty"
                        ng-options="n for n in getArray(item.quantity)">
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button class="btn btn-secondary me-2" ng-click="goToStep(2)">Back</button>
      <button class="btn btn-primary" ng-disabled="!hasSelectedItems()" ng-click="goToStep(4)">Continue</button>
    </div>

    <!-- STEP 4 -->
    <div class="step-section" ng-class="{active: currentStep===4}">
      <h4>4. Reason for Return</h4>
      <div class="mb-3">
        <div class="reason-option"
             ng-repeat="r in returnReasons"
             ng-click="selectReason(r)"
             ng-class="{'selected': returnData.reason===r.value}">
          {{r.label}}
        </div>
      </div>
      <div ng-if="returnData.reason==='other'" class="mb-3">
        <label>Please specify:</label>
        <textarea class="form-control" ng-model="returnData.details" rows="3"></textarea>
      </div>
      <button class="btn btn-secondary me-2" ng-click="goToStep(3)">Back</button>
      <button class="btn btn-primary" ng-disabled="!returnData.reason" ng-click="goToStep(5)">Continue</button>
    </div>

    <!-- STEP 5 -->
    <div class="step-section" ng-class="{active: currentStep===5}">
      <h4>5. Review & Submit Return</h4>
      <p>
        <strong>Order #{{selectedOrder.confirmationNumber}}</strong>
        ({{selectedOrder.date | date:'mediumDate'}})
      </p>
      <ul class="list-group mb-3">
        <li class="list-group-item"
            ng-repeat="item in selectedOrder.items | filter:{selected:true}">
          <img ng-src="{{item.image}}" class="product-img me-2">
          {{item.name}} × {{item.returnQty}} — ${{(item.price*item.returnQty).toFixed(2)}}
        </li>
      </ul>
      <p><strong>Reason:</strong> {{getReasonLabel(returnData.reason)}}</p>
      <p ng-if="returnData.details"><strong>Details:</strong> {{returnData.details}}</p>
      <button class="btn btn-secondary me-2" ng-click="goToStep(4)">Back</button>
      <button class="btn btn-success" ng-click="submitReturn()">Submit Return</button>
    </div>
  </div>

  <script>
    angular.module('returnsApp', [])
      .controller('ReturnsController', ['$scope', function($scope) {
        // state
        $scope.currentStep    = 1;
        $scope.search         = { email: '', orderNumber: '' };
        $scope.orders         = [];
        $scope.selectedOrder  = null;
        $scope.returnReasons  = [
          {value:'wrong-item',label:'Wrong Item Received'},
          {value:'defective',label:'Defective/Damaged'},
          {value:'not-as-described',label:'Not As Described'},
          {value:'no-longer-needed',label:'No Longer Needed'},
          {value:'better-price',label:'Found Better Price'},
          {value:'other',label:'Other'}
        ];
        $scope.returnData     = { reason: '', details: '' };

        // navigation
        $scope.goToStep = step => $scope.currentStep = step;

        // Step 1 → load from localStorage key "currentorder"
        $scope.findOrders = () => {
          let all = [];
          try {
            const raw = localStorage.getItem('currentorder');
            all = JSON.parse(raw) || [];
          } catch(e) {
            console.error('Could not parse currentorder:', e);
          }
          const e = $scope.search.email.trim().toLowerCase();
          const n = $scope.search.orderNumber.trim();
          if (!e && !n) {
            return alert('Please enter either an email or a confirmation number.');
          }
          $scope.orders = all.filter(o => {
            const storedEmail = (
              (o.shipping?.address?.email) ||
              o.email ||
              ''
            ).toLowerCase();
            const emailMatch = e && storedEmail.includes(e);
            const numMatch   = n && o.confirmationNumber === n;
            return emailMatch || numMatch;
          });
          $scope.goToStep(2);
        };

        // Step 2
        $scope.selectOrder = order => {
          $scope.selectedOrder = angular.copy(order);
          $scope.selectedOrder.items.forEach(i => {
            i.selected  = false;
            i.returnQty = i.quantity;
          });
        };

        // helpers
        $scope.getArray        = n => Array.from({length:n}, (_,i)=>i+1);
        $scope.hasSelectedItems= () => $scope.selectedOrder.items.some(i=>i.selected);
        $scope.selectReason    = r => $scope.returnData.reason = r.value;
        $scope.getReasonLabel  = v => ($scope.returnReasons.find(r=>r.value===v)||{}).label;
        $scope.getOrderTotal   = o => {
          const itemsSum = o.items.reduce((sum,i)=>sum + i.price*i.quantity, 0);
          const shipCost = o.shipping?.method === 'express'   ? 12.99
                         : o.shipping?.method === 'standard'  ? 5.99
                         : 24.99;
          return itemsSum * 1.06 + shipCost;
        };

        // submit
        $scope.submitReturn = () => {
          alert('Return submitted!');
          // reset everything
          $scope.search        = { email: '', orderNumber: '' };
          $scope.orders        = [];
          $scope.selectedOrder = null;
          $scope.returnData    = { reason: '', details: '' };
          $scope.goToStep(1);
        };
      }]);
  </script>
</body>
</html>












