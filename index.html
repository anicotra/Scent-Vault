<!DOCTYPE html>
<html lang="en" ng-app="StoreApp">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Web Storefront</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <link rel="stylesheet" href="style.css">
   <style>
      .highlight {
         border: 3px solid red !important;
         box-shadow: 0 0 10px red;
         transition: box-shadow 0.3s ease-in-out;
      }

      .header-container {
         text-align: center;
         margin-top: 20px;
      }

      .product-container {
         display: flex;
         justify-content: center;
         flex-wrap: wrap;
      }
   </style>
</head>

<body ng-controller="ProductController">

   <!--menu-->
   <div class="d-flex">
      <div class="sidebar p-3 bg-light border-end">
         <h2 class="text-center">Menu</h2>
         <button class="btn btn-primary w-100 mb-2" onclick="openSignup()">Sign Up</button>
         <a href="returns.html" class="btn btn-info w-100 mb-2">Returns</a>
         <a href="ProductManagement.html" class="btn btn-warning w-100 mb-2">Product Management</a>
         <button onclick="localStorage.clear(); location.reload();" class="btn btn-warning btn-sm w-100 mb-2">Reset Product Data</button>
      </div>

      <!--shopping cart icon-->
      <div class="position-absolute top-0 end-0 p-3">
         <a href="cart.html">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQs0BWuHgxw4SK8_8IPduATr0KXh4mgQjxIDA&s"
               alt="Cart" class="cart-icon">
         </a>
      </div>


      <!--Products -->
      <div class="content p-4 w-100 text-center">
         <h1>Welcome to Scent Vault</h1>
         <input type="text" id="searchBar" class="form-control" placeholder="Search products..." ng-model="searchQuery" ng-change="searchProducts()" style="position: absolute; top: 20px; right: 20px; width: 250px; max-width: 100%;">
         <h2>Our Products:</h2>
         <div class="container">
            <div id="productGrid" class="row row-cols-3 g-4">
               <div class="col" ng-repeat="product in filteredProducts">
                 <div class="product-box p-3 bg-light border rounded text-center" ng-class="{'highlight': product.highlight}">
                   <img ng-src="{{product.image}}" alt="{{product.name}}" class="product-img">
                   <h3 class="mt-2">{{product.name}}</h3>
                   <p ng-if="product.desc"><strong>Type:</strong> {{product.desc}}</p>
                   <p><strong>Notes:</strong> {{product.category}}</p>
                   <p><strong>Size:</strong> {{product.unit}}</p>
                   <p><strong>Price:</strong> ${{product.price}}</p>
                   <button class="btn btn-primary add-to-cart" ng-click="addToCart(product)">Add to Cart</button>
                 </div>
               </div>
            </div>
         </div>
      </div>
   </div>


      <div class="overlay" id="overlay" onclick="closeForms()"></div>

      <!--shopping cart-->
      <div class="cart-container mt-5 p-3 border rounded">
         <h3>Cart Items</h3>
         <div id="cartItems"></div>
         <p class="cart-total mt-3">Total: $<span id="cartTotal">0.00</span></p>
         <button class="btn btn-danger" onclick="clearCart()">Clear Cart</button>
      </div>
   </div>

   <!--sign up pop up-->

   <div class="popup" id="signupPopup" style="display: none;">
      <div class="popup-header">
         <h2>Sign Up</h2>
         <button class="close-popup" onclick="closeSignup()">Ã—</button>
      </div>
      <form onsubmit="showThankYou(event)">
         <label for="email">Email:</label>
         <input type="email" id="email" required class="form-control">
         <label for="Name">Name:</label>
         <input type="text" id="Name" required class="form-control">
         <label for="age">Age:</label>
         <input type="number" id="age" required class="form-control">
         <label for="address">Address:</label>
         <input type="text" id="address" required class="form-control">
         <label for="phone">Phone Number (optional):</label>
         <input type="tel" id="phone" class="form-control">
         <button type="submit" class="btn btn-success mt-3">Submit</button>
      </form>
   </div>

<div class="overlay" id="overlay" onclick="closeForms()"></div>

   <div class="popup" id="thankYouPopup" style="display: none;">
      <h2>Thank you for signing up!</h2>
      <button class="btn btn-primary" onclick="closeThankYou()">Close</button>
   </div>

   <!--Project management popup-->
   <div class="popup" id="passwordPopup" style="display: none;">
      <h2>Enter Password(Password is: Admin)</h2>
      <input type="password" id="passwordInput" class="form-control" placeholder="Enter password">
      <div class="d-flex justify-content-between mt-2">
         <button class="btn btn-success" onclick="checkPassword()">Submit</button>
         <button class="btn btn-danger" onclick="closePasswordPrompt()">Cancel</button>
      </div>
      <p id="passwordError" class="text-danger mt-2" style="display: none;">Incorrect password. Try again.</p>
   </div>

   <script>
angular.module('StoreApp', [])
        .controller('ProductController', ['$scope', '$http', function($scope, $http) {
            $scope.products = [];
            $scope.filteredProducts = [];
            $scope.searchQuery = '';
            
            // Load products from backend
            $scope.loadProducts = function() {
                $http.get('/api/products')
                    .then(function(response) {
                        $scope.products = response.data;
                        $scope.filteredProducts = angular.copy($scope.products);
                    })
                    .catch(function(error) {
                        console.error('Error loading products:', error);
                    });
            };
            
            // Search products
            $scope.searchProducts = function() {
                if (!$scope.searchQuery) {
                    $scope.filteredProducts = angular.copy($scope.products);
                    return;
                }
                
                const query = $scope.searchQuery.toLowerCase();
                $scope.filteredProducts = $scope.products.filter(product => {
                    return product.name.toLowerCase().includes(query);
                });
                
                // Highlight matching products
                $scope.products.forEach(product => {
                    product.highlight = product.name.toLowerCase().includes(query);
                });
            };
            
            // Add to cart
            $scope.addToCart = function(product) {
                $http.post('/api/cart', {
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image
                }).then(function(response) {
                    alert('Product added to cart!');
                }).catch(function(error) {
                    console.error('Error adding to cart:', error);
                    alert('Failed to add product to cart');
                });
            };
            
            // Signup functions
            $scope.openSignup = function() {
                document.getElementById('signupPopup').style.display = 'block';
                document.getElementById('overlay').style.display = 'block';
            };
            
            $scope.resetData = function() {
                localStorage.clear();
                location.reload();
            };
            
            // Initialize
            $scope.loadProducts();
        }]);
            
   </script>
   <style>
      .popup {
         display: none;
         position: fixed;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         background: white;
         padding: 20px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
         z-index: 1000;
         border-radius: 10px;
         width: 300px;
         text-align: center;
      }

      .overlay {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.5);
         z-index: 999;
      }

      .product-box {
         background: #f9f9f9;
         padding: 15px;
         border-radius: 8px;
         box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
         text-align: center;
         font-size: 1em;
         font-weight: bold;
         width: 100%;
         max-width: 250px;
         margin: auto;
         display: flex;
         flex-direction: column;
         align-items: center;
      }

      .product-img {
         width: 100%;
         max-width: 200px;
         height: auto;
         object-fit: contain;
         border-radius: 5px;
         margin-bottom: 10px;
      }

      .content {
         margin-left: 220px;
         width: calc(100% - 220px);
         padding: 20px;
      }
   </style>
</body>

</html>
