<!DOCTYPE html>
<html lang="en" ng-app="ProductManagementApp">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Product Management</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <link rel="stylesheet" href="style.css">
</head>

<body ng-controller="ProductManagementController">
   <div class="container mt-5">
      <h2>Product Management</h2>
      <a href="index.html" class="btn btn-secondary mb-3">Back to Store</a>

      <input type="text" id="searchBar" class="form-control mb-2" placeholder="Search products...">
      <button class="btn btn-primary mb-4" onclick="searchProducts()">Search</button>

      <h3>Add or Update Product</h3>
      <form id="productForm">
         <input type="hidden" id="productIndex">
         <label>Product Name:</label>
         <input type="text" id="productId" class="form-control" required>
         <label>Description (Notes):</label>
         <input type="text" id="productDesc" class="form-control" required>
         <label>Category (Type):</label>
         <input type="text" id="productCategory" class="form-control" required>
         <label>Unit (ML):</label>
         <input type="text" id="productUnit" class="form-control" required>
         <label>Price:</label>
         <input type="number" id="productPrice" class="form-control" required>
         <label>Image URL:</label>
         <input type="text" id="productImage" class="form-control">
         <button type="submit" class="btn btn-success mt-3">Submit</button>
      </form>

      <h3 class="mt-5">Products</h3>
      <div class="row row-cols-3 g-4">
         <div class="col-md-4" ng-repeat="product in filteredProducts">
            <div class="p-3 bg-light border rounded text-center">
               <img ng-src="{{product.image}}" class="product-img">
               <h3>{{product.name}}</h3>
               <p><strong>Notes:</strong> {{product.category}}</p>
               <p><strong>Type:</strong> {{product.desc}}</p>
               <p><strong>Size:</strong> {{product.unit}}</p>
               <p><strong>Price:</strong> {{product.price}}</p>
               <button class="btn btn-warning" ng-click="editProduct(product)">Edit</button>
               <button class="btn btn-danger" ng-click="deleteProduct(product)">Delete</button>
            </div>
         </div>
      </div>
   </div>

   <script>
      angular.module('ProductManagementApp', [])
        .controller('ProductManagementController', ['$scope', '$http', function($scope, $http) {
            $scope.products = [];
            $scope.filteredProducts = [];
            $scope.currentProduct = {};
            $scope.searchQuery = '';
            
            // Load products
            $scope.loadProducts = function() {
                $http.get('/api/products')
                    .then(function(response) {
                        $scope.products = response.data;
                        $scope.filteredProducts = angular.copy($scope.products);
                    });
            };
            
            // Search products
            $scope.searchProducts = function() {
                if (!$scope.searchQuery) {
                    $scope.filteredProducts = angular.copy($scope.products);
                    return;
                }
                
                const query = $scope.searchQuery.toLowerCase();
                $scope.filteredProducts = $scope.products.filter(product => 
                    product.name.toLowerCase().includes(query)
                );
            };
            
            // Edit product
            $scope.editProduct = function(product) {
                $scope.currentProduct = angular.copy(product);
            };
            
            // Delete product
            $scope.deleteProduct = function(product) {
                if (confirm('Are you sure you want to delete this product?')) {
                    $http.delete('/api/products/' + product.id)
                        .then(function() {
                            $scope.loadProducts();
                        });
                }
            };
            
            // Submit product
            $scope.submitProduct = function() {
                const method = $scope.currentProduct.id ? 'put' : 'post';
                const url = $scope.currentProduct.id ? 
                    '/api/products/' + $scope.currentProduct.id : '/api/products';
                
                $http[method](url, $scope.currentProduct)
                    .then(function() {
                        $scope.loadProducts();
                        $scope.currentProduct = {};
                    });
            };
            
            // Initialize
            $scope.loadProducts();
        }]);

   </script>
</body>

</html>
